<ion-header>
  <ion-toolbar class="promo-modal-header">
    <ion-title class="ion-text-center promo-header-title">
      {{ getTituloCorto() }}
    </ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="close()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="custom-content">
  <div class="promo-modal-shell">
    <div class="promo-card">

      <!-- HERO: imagen + empresa -->
      <div class="promo-hero">
        <div class="promo-hero-img" *ngIf="promoImg">
          <img [src]="promoImg" [alt]="promocion?.nombre" />
        </div>

        <div class="promo-hero-info">
          <div class="promo-company">
            <div class="promo-company-logo" *ngIf="empresaLogo">
              <img [src]="empresaLogo" [alt]="promocion?.empresaNombre" />
            </div>
            <div class="promo-company-text">
              <span class="label">Promoción de</span>
              <span class="name">{{ promocion?.empresaNombre }}</span>
            </div>
          </div>

          <p class="promo-title">
            {{ promocion?.nombre }}
          </p>

          <p class="promo-description">
            {{ promocion?.descripcion }}
          </p>
        </div>
      </div>


      <!-- ============================
           MENSAJE SI YA FUE CANJEADO
      ==============================-->
      <div class="promo-qr-warning" *ngIf="yaCanjeado">
        <ion-icon name="information-circle-outline"></ion-icon>
        <p>{{ mensajeEstado }}</p>
      </div>


      <!-- ============================
           QR SOLO SI NO ESTÁ CANJEADO
      ==============================-->
      <div class="promo-qr-block" *ngIf="!yaCanjeado && codigoQrBase64">
        <p class="promo-qr-title">
          Presenta este código en el establecimiento
        </p>

        <div class="promo-qr-wrapper">
          <img
            [src]="'data:image/png;base64,' + codigoQrBase64"
            alt="Código QR de la promoción"
          />
        </div>

        <p class="promo-qr-note">
          Cupón de <strong>un solo uso</strong>, personal e intransferible.
        </p>

        <p class="promo-qr-location">
          Ubicación: <strong>{{ empresaUbicacion }}</strong>
        </p>

        <p class="promo-qr-valid" *ngIf="promocion?.vigencia">
          Vigente hasta <strong>{{ promocion?.vigencia }}</strong>
        </p>
      </div>




      <!-- ============================
           LOADER SOLO SI NO CANJEADO
      ==============================-->
      <div class="promo-qr-loading" *ngIf="!yaCanjeado && !codigoQrBase64 && cargandoQr">
        <ion-spinner name="crescent"></ion-spinner>
        <span>Generando tu código…</span>
      </div>

    </div>

    <ion-button expand="block" shape="round" class="btn-close" (click)="close()">
      Cerrar
    </ion-button>

    <ion-button
      *ngIf="tieneUbicacionValida"
      expand="block"
      shape="round"
      class="btn-location"
      (click)="abrirUbicacion()">
      Ver ubicación
    </ion-button>
  </div>
</ion-content>