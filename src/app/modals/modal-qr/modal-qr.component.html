<ion-content class="promo-screen" [fullscreen]="true">
  <div *ngIf="codigoPromocion" class="promo-shell">
    <div
      class="promo-card"
      [ngClass]="{
        'is-loading': EstatusObtenerInformacionDelCodigo === 1,
        'is-valid':   EstatusDelCodigo === 1,
        'is-invalid': EstatusDelCodigo === -1
      }"
    >
      <!-- Encabezado -->
      <div class="card-head">
        <div class="head-icon">
          <ion-icon *ngIf="EstatusObtenerInformacionDelCodigo === 1" name="qr-code-outline"></ion-icon>
          <ion-icon *ngIf="EstatusDelCodigo === 1 && EstatusObtenerInformacionDelCodigo !== 1" name="checkmark-circle-outline"></ion-icon>
          <ion-icon *ngIf="EstatusDelCodigo === -1 && EstatusObtenerInformacionDelCodigo !== 1" name="alert-circle-outline"></ion-icon>
        </div>

        <div class="head-titles">
          <h3 class="head-title" aria-live="polite">
            {{
              EstatusObtenerInformacionDelCodigo === 1
                ? 'Validando código'
                : EstatusDelCodigo === 1
                ? 'Código válido'
                : 'Código no válido'
            }}
          </h3>

          <p class="head-sub" *ngIf="EstatusObtenerInformacionDelCodigo === 1">Por favor, espera…</p>
          <p class="head-sub" *ngIf="EstatusDelCodigo === 1 && EstatusObtenerInformacionDelCodigo !== 1">
            El código es válido y está activo.
          </p>
          <p class="head-sub" *ngIf="EstatusDelCodigo === -1 && EstatusObtenerInformacionDelCodigo !== 1">
            Este código no está activo.
          </p>
        </div>
      </div>

      <!-- Código + copiar -->
      <div class="code-row">
        <div class="code-pill" title="Código"><span>{{ codigoPromocion }}</span></div>
        <button type="button" class="icon-btn" (click)="copiarCodigo(codigoPromocion)" aria-label="Copiar código">
          <ion-icon name="copy-outline"></ion-icon>
        </button>
      </div>

      <!-- Progreso -->
      <ion-progress-bar
        *ngIf="EstatusObtenerInformacionDelCodigo === 1"
        type="indeterminate"
        class="bar"
      ></ion-progress-bar>

      <!-- Detalles (válido) -->
      <div *ngIf="EstatusDelCodigo === 1" class="details">
        <div class="line">
          <span class="label">Promoción</span>
          <span class="value">{{ promocionRelacionada?.nombre }}</span>
        </div>

        <div class="description">{{ promocionRelacionada?.descripcion }}</div>

        <div class="line">
          <span class="label">Vigencia</span>
          <span class="value">{{ promocionRelacionada?.vigencia }}</span>
        </div>

        <div class="status-badge success">
          <ion-icon name="checkmark-outline"></ion-icon>
          Activo
        </div>
      </div>

      <!-- Detalles (inválido) -->
      <div *ngIf="EstatusDelCodigo === -1" class="details">
        <div class="status-badge danger">
          <ion-icon name="close-outline"></ion-icon>
          Inactivo
        </div>
        <div class="reason" *ngIf="MotivoInactividad">{{ MotivoInactividad }}</div>
      </div>

      <!-- Estados de activación -->
      <div class="actions" *ngIf="EstatusDelCodigo === 1">
        <ng-container *ngIf="EstatusActivacionDelCodigo === 0">
          <button class="btn primary" (click)="ActivarPromocion()">Validar código</button>
          <button class="btn ghost" (click)="close()">Salir</button>
        </ng-container>

        <div class="activating" *ngIf="EstatusActivacionDelCodigo === 2">
          <app-loader></app-loader>
          <span>Activando promoción…</span>
        </div>

        <div class="callout success" *ngIf="EstatusActivacionDelCodigo === 1">
          <ion-icon name="sparkles-outline"></ion-icon>
          ¡Promoción activada con éxito!
        </div>

        <div class="callout danger" *ngIf="EstatusActivacionDelCodigo === -1">
          <ion-icon name="warning-outline"></ion-icon>
          Hubo un error al activar la promoción. Intenta de nuevo.
        </div>
      </div>
    </div>

    <!-- Acciones fijas abajo (siempre mostrar Salir tras escanear) -->
    <div class="promo-actions" *ngIf="codigoPromocion">
      <!-- Validado y pendiente de activar -->
      <button
        class="btn-outline"
        (click)="close()"
        *ngIf="EstatusDelCodigo === 1 && EstatusActivacionDelCodigo === 0"
      >
        Salir
      </button>
      <button
        class="btn-primary"
        (click)="ActivarPromocion()"
        *ngIf="EstatusDelCodigo === 1 && EstatusActivacionDelCodigo === 0"
      >
        Validar código
      </button>

      <!-- Activando -->
      <button
        class="btn-outline"
        (click)="close()"
        *ngIf="EstatusDelCodigo === 1 && EstatusActivacionDelCodigo === 2"
      >
        Salir
      </button>

      <!-- Activado -->
      <button
        class="btn-primary"
        (click)="close()"
        *ngIf="EstatusDelCodigo === 1 && EstatusActivacionDelCodigo === 1"
      >
        Listo / Salir
      </button>

      <!-- Error de activación -->
      <button
        class="btn-outline"
        (click)="close()"
        *ngIf="EstatusDelCodigo === 1 && EstatusActivacionDelCodigo === -1"
      >
        Salir
      </button>

      <!-- Inválido -->
      <button class="btn-outline" (click)="close()" *ngIf="EstatusDelCodigo === -1">Salir</button>

      <!-- Validando info -->
      <button
        class="btn-outline"
        (click)="close()"
        *ngIf="EstatusObtenerInformacionDelCodigo === 1"
      >
        Salir
      </button>
    </div>
  </div>
</ion-content>