<ion-content class="promo-screen" [fullscreen]="true">
  <div *ngIf="codigoPromocion" class="promo-shell">
    <div
      class="promo-card"
      [ngClass]="{
        'is-loading': EstatusObtenerInformacionDelCodigo === 1,
        'is-valid':   EstatusDelCodigo === 1,
        'is-invalid': EstatusDelCodigo === -1
      }"
    >
      <!-- Cabecera -->
      <div class="card-head">
        <div class="head-icon">
          <ion-icon *ngIf="EstatusObtenerInformacionDelCodigo === 1" name="qr-code-outline"></ion-icon>
          <ion-icon *ngIf="EstatusDelCodigo === 1 && EstatusObtenerInformacionDelCodigo !== 1" name="checkmark-circle-outline"></ion-icon>
          <ion-icon *ngIf="EstatusDelCodigo === -1 && EstatusObtenerInformacionDelCodigo !== 1" name="alert-circle-outline"></ion-icon>
        </div>

        <div class="head-titles">
          <h3 class="head-title">
            {{
              EstatusObtenerInformacionDelCodigo === 1
                ? 'Validando código'
                : EstatusDelCodigo === 1
                ? 'Código válido'
                : 'Código no válido'
            }}
          </h3>

          <p class="head-sub" *ngIf="EstatusObtenerInformacionDelCodigo === 1">Por favor, espera…</p>
          <p class="head-sub" *ngIf="EstatusDelCodigo === 1 && EstatusObtenerInformacionDelCodigo !== 1">El código es válido y está activo.</p>
          <p class="head-sub" *ngIf="EstatusDelCodigo === -1 && EstatusObtenerInformacionDelCodigo !== 1">Este código no está activo.</p>
        </div>
      </div>

      <!-- Código + copiar -->
      <div class="code-row">
        <div class="code-pill" title="Código"><span>{{ codigoPromocion }}</span></div>
        <button type="button" class="icon-btn" (click)="copiarCodigo(codigoPromocion)" aria-label="Copiar código">
          <ion-icon name="copy-outline"></ion-icon>
        </button>
      </div>

      <!-- Progreso -->
      <ion-progress-bar *ngIf="EstatusObtenerInformacionDelCodigo === 1" type="indeterminate" class="bar"></ion-progress-bar>

      <!-- Detalles VÁLIDO -->
      <ng-container *ngIf="EstatusDelCodigo === 1">
        <div class="details">
          <div class="line">
            <span class="label">Promoción</span>
            <span class="value">{{ promocionRelacionada?.nombre }}</span>
          </div>

          <div class="description">{{ promocionRelacionada?.descripcion }}</div>

          <div class="line">
            <span class="label">Vigencia</span>
            <span class="value">{{ promocionRelacionada?.vigencia }}</span>
          </div>

          <div class="status-badge success">
            <ion-icon name="checkmark-outline"></ion-icon>
            Activo
          </div>
        </div>

        <!-- ACCIONES (un solo bloque con switch) -->
        <div class="actions">
          <ng-container [ngSwitch]="EstatusActivacionDelCodigo">
            <!-- Listo para activar -->
            <div *ngSwitchCase="0" class="grid-2">
              <button class="btn primary" (click)="ActivarPromocion()">Validar código</button>
              <button class="btn ghost" (click)="close()">Salir</button>
            </div>

            <!-- Activando -->
            <div *ngSwitchCase="2" class="activating">
              <app-loader></app-loader>
              <span>Activando promoción…</span>
            </div>

            <!-- Activación OK -->
            <div *ngSwitchCase="1" class="stack">
              <div class="callout success">
                <ion-icon name="sparkles-outline"></ion-icon>
                ¡Promoción activada con éxito!
              </div>
              <button class="btn primary" (click)="close()">Cerrar</button>
            </div>

            <!-- Error al activar -->
            <div *ngSwitchCase="-1" class="stack">
              <div class="callout danger">
                <ion-icon name="warning-outline"></ion-icon>
                Hubo un error al activar la promoción. Intenta de nuevo.
              </div>
              <button class="btn ghost" (click)="close()">Salir</button>
            </div>
          </ng-container>
        </div>
      </ng-container>

      <!-- Detalles INVÁLIDO -->
      <ng-container *ngIf="EstatusDelCodigo === -1">
        <div class="details">
          <div class="status-badge danger">
            <ion-icon name="close-outline"></ion-icon>
            Inactivo
          </div>
          <div class="reason" *ngIf="MotivoInactividad">{{ MotivoInactividad }}</div>
        </div>

        <div class="actions">
          <button class="btn ghost" (click)="close()">Salir</button>
        </div>
      </ng-container>
    </div>
  </div>
</ion-content>