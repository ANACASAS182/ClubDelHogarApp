<ion-header>
  <ion-toolbar class="promo-scan-header">
    <ion-title>
      Escanea el c√≥digo del cliente
    </ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="close()">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="promo-screen">

  <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
       ‚ïë VISTA 1: ESCANEAR C√ìDIGO (STEP 1) ‚ïë
       ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
  <ng-container *ngIf="!codigoPromocion; else resultadoCodigo">
    <div class="promo-shell">
      <div class="promo-card scan-card is-loading">
        <div class="card-head">
          <div class="head-icon">
            <ion-icon name="qr-code-outline"></ion-icon>
          </div>

          <div class="head-titles">
            <h3 class="head-title">Escanea el c√≥digo del cliente</h3>
            <p class="head-sub">
              Alinea el c√≥digo QR dentro del recuadro para comenzar la validaci√≥n.
            </p>
          </div>
        </div>

        <div class="scan-body">
          <div id="qr-reader" class="qr-reader-box"></div>

          <ul class="scan-tips">
            <li>Aseg√∫rate de que el c√≥digo sea legible.</li>
            <li>Evita reflejos o poca iluminaci√≥n.</li>
            <li>El c√≥digo debe pertenecer a Club del Hogar.</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Barra fija solo con Cerrar -->
    <div class="promo-actions">
      <button class="btn-outline" (click)="close()">
        Cerrar
      </button>
    </div>
  </ng-container>

  <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
       ‚ïë VISTA 2: RESULTADO DEL C√ìDIGO    ‚ïë
       ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
  <ng-template #resultadoCodigo>
  <div class="promo-shell">
    <div
      class="promo-card"
      [ngClass]="{
        'is-loading': EstatusObtenerInformacionDelCodigo === 1,
        'is-valid':   EstatusDelCodigo === 1 && EstatusObtenerInformacionDelCodigo !== 1,
        'is-invalid': EstatusDelCodigo === -1 && EstatusObtenerInformacionDelCodigo !== 1
      }"
    >
      <!-- Cabecera -->
      <div class="card-head">
        <div class="head-icon">
          <ion-icon
            *ngIf="EstatusObtenerInformacionDelCodigo === 1"
            name="qr-code-outline"
          ></ion-icon>

          <ion-icon
            *ngIf="EstatusDelCodigo === 1 && EstatusObtenerInformacionDelCodigo !== 1"
            name="checkmark-circle-outline"
          ></ion-icon>

          <ion-icon
            *ngIf="EstatusDelCodigo === -1 && EstatusObtenerInformacionDelCodigo !== 1"
            name="alert-circle-outline"
          ></ion-icon>
        </div>

        <div class="head-titles">
          <h3 class="head-title">
            {{
              EstatusObtenerInformacionDelCodigo === 1
                ? 'Validando c√≥digo‚Ä¶'
                : EstatusDelCodigo === 1
                  ? 'C√≥digo v√°lido'
                  : 'C√≥digo no v√°lido'
            }}
          </h3>

          <p class="head-sub" *ngIf="EstatusObtenerInformacionDelCodigo === 1">
            Consultando la promoci√≥n asociada al c√≥digo.
          </p>

          <p
            class="head-sub"
            *ngIf="EstatusDelCodigo === 1 && EstatusObtenerInformacionDelCodigo !== 1"
          >
            El c√≥digo pertenece a una promoci√≥n activa.
          </p>

          <p
            class="head-sub"
            *ngIf="EstatusDelCodigo === -1 && EstatusObtenerInformacionDelCodigo !== 1"
          >
            No pudimos validar este c√≥digo. Revisa la informaci√≥n abajo.
          </p>
        </div>
      </div>

      <!-- üîπ Banda de estado grande -->
      <div
        class="status-strip"
        *ngIf="EstatusObtenerInformacionDelCodigo !== 1"
        [ngClass]="{
          ok:  EstatusDelCodigo === 1,
          bad: EstatusDelCodigo === -1
        }"
      >
        <ion-icon
          *ngIf="EstatusDelCodigo === 1"
          name="checkmark-circle"
        ></ion-icon>

        <ion-icon
          *ngIf="EstatusDelCodigo === -1"
          name="close-circle"
        ></ion-icon>

        <span>
          {{
            EstatusDelCodigo === 1
              ? 'C√≥digo v√°lido y listo para activar'
              : 'Este c√≥digo no se puede utilizar'
          }}
        </span>
      </div>

      <!-- C√≥digo + copiar -->
      <div class="code-row">
        <div class="code-pill" title="C√≥digo">
          <span>{{ codigoPromocion }}</span>
        </div>
        <button
          type="button"
          class="icon-btn"
          (click)="copiarCodigo(codigoPromocion)"
          aria-label="Copiar c√≥digo"
        >
          <ion-icon name="copy-outline"></ion-icon>
        </button>
      </div>

      <!-- Barra de progreso mientras consulta -->
      <ion-progress-bar
        *ngIf="EstatusObtenerInformacionDelCodigo === 1"
        type="indeterminate"
        class="bar"
      ></ion-progress-bar>

      <!-- Detalles V√ÅLIDO -->
      <ng-container *ngIf="EstatusDelCodigo === 1">
        <div class="details">
          <div class="line">
            <span class="label">Promoci√≥n</span>
            <span class="value">{{ promocionRelacionada?.nombre }}</span>
          </div>

          <div class="description">
            {{ promocionRelacionada?.descripcion }}
          </div>

          <div class="line" *ngIf="promocionRelacionada?.vigencia">
            <span class="label">Vigencia</span>
            <span class="value">{{ promocionRelacionada?.vigencia }}</span>
          </div>

          <div class="status-badge success">
            <ion-icon name="checkmark-outline"></ion-icon>
            C√≥digo activo
          </div>
        </div>
      </ng-container>

      <!-- Detalles INV√ÅLIDO -->
      <ng-container *ngIf="EstatusDelCodigo === -1">
        <div class="details">
          <div class="status-badge danger">
            <ion-icon name="close-outline"></ion-icon>
            C√≥digo no v√°lido
          </div>
          <div class="error-msg" *ngIf="EstatusActivacionDelCodigo === -1 && MotivoInactividad">
            {{ MotivoInactividad }}
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- Barra fija de acciones (igual que ya ten√≠as) -->
  <div class="promo-actions">
    <button
      class="btn-primary"
      *ngIf="EstatusDelCodigo === 1 && EstatusActivacionDelCodigo === 0"
      (click)="ActivarPromocion()"
    >
      Validar c√≥digo
    </button>

    <button
      class="btn-primary"
      disabled
      *ngIf="EstatusActivacionDelCodigo === 2"
    >
      Activando promoci√≥n‚Ä¶
    </button>

    <button
      class="btn-primary"
      disabled
      *ngIf="EstatusActivacionDelCodigo === 1"
    >
      Promoci√≥n activada ‚úî
    </button>

    <button class="btn-outline" (click)="close()">
      Cerrar
    </button>
  </div>
</ng-template>
</ion-content>