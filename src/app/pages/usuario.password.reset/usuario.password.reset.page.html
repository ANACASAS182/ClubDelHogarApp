<ion-content class="page" fullscreen>
  <div class="center-wrapper">

    <div class="card" [formGroup]="passwordResetForm">
      <img src="assets/logo.png" alt="Logo" class="logo" />
      <h2 class="form-title">Cambio de contraseña</h2>

      @if (hasError) {
      <div class="ion-padding custom-alert warning">
        <ion-text> {{ messageError }}</ion-text>
      </div>
      }

      <ion-input class="input" [class.invalid]="getControl('password')?.invalid && getControl('password')?.touched"
        formControlName="password" placeholder="Nueva contraseña" type="password"
        (ionBlur)="getControl('password')?.markAsTouched()" (ionInput)="checkStrength()">
        <ion-input-password-toggle slot="end"></ion-input-password-toggle>
      </ion-input>

      <ion-progress-bar [value]="passwordStrengthValue" [color]="passwordStrengthColor"></ion-progress-bar>
      <ion-text color="{{ passwordStrengthColor }}">
        {{ passwordStrengthText }}
      </ion-text>
      <ion-text color="danger" *ngIf="getControl('password')?.hasError('required') && getControl('password')?.touched">
        Campo requerido
      </ion-text>
      <ion-text color="danger" *ngIf="getControl('password')?.hasError('minlength') && getControl('password')?.touched">
        La contraseña debe tener al menos 6 caracteres.
      </ion-text>

      <ion-input class="input"
        [class.invalid]="getControl('confirmPassword')?.invalid && getControl('confirmPassword')?.touched"
        formControlName="confirmPassword" placeholder="Confirmar nueva contraseña" type="password"
        (ionBlur)="getControl('confirmPassword')?.markAsTouched()">
        <ion-input-password-toggle slot="end"></ion-input-password-toggle>
      </ion-input>

      <ion-text color="danger" *ngIf="getControl('confirmPassword')?.invalid && getControl('confirmPassword')?.touched">
        Campo requerido
      </ion-text>
      <ion-text color="danger"
        *ngIf="getControl('confirmPassword')?.errors?.['mustMatch'] && getControl('confirmPassword')?.touched">
        Contraseña no coincide
      </ion-text>

      <ion-button expand="block" shape="round" class="customButton" [disabled]="formEnviado" (click)="onSubmit()">CAMBIAR CONTRASEÑA</ion-button>

      <div class="inner-curve">
        <svg viewBox="0 0 500 150" preserveAspectRatio="none">
          <path d="M0,0 C150,100 350,0 500,100 L500,150 L0,150 Z" fill="#d6eaf8"></path>
        </svg>
      </div>
    </div>
  </div>
</ion-content>