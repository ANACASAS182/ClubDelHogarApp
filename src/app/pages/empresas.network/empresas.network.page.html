<ion-header>
  <ion-toolbar class="headerColor network-header">
    <!-- Men√∫ lateral (aunque no haya dashboard, lo puedes seguir usando) -->
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>

    <!-- Marca CDH -->
    <ion-title>
      <div class="brand-wrap">
        <img
          src="assets/logo_blancoCDH.png"
          alt="Club del Hogar"
          class="brand-logo"
        />
        <div class="brand-text">
          <span class="brand-title">Club del Hogar</span>
          <span class="brand-subtitle">Promociones para ti</span>
        </div>
      </div>
    </ion-title>

    <!-- Men√∫ de usuario (solo circulito + flecha) -->
    <ion-buttons slot="end">
      <button
        class="user-chip"
        id="user-menu-trigger"
        type="button"
      >
        <div class="user-avatar">
          {{ inicialesUsuario }}
        </div>
        <ion-icon name="chevron-down-outline"></ion-icon>
      </button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Popover con acciones de usuario -->
  <ion-popover
    trigger="user-menu-trigger"
    triggerAction="click"
    [dismissOnSelect]="true"
  >
    <ng-template>
      <ion-list>
        <ion-item lines="none">
          <ion-label>
            <h3>{{ nombreUsuario || 'Mi cuenta' }}</h3>
            <p *ngIf="correoUsuario">{{ correoUsuario }}</p>
          </ion-label>
        </ion-item>

        <ion-item button detail="false" (click)="irConfiguracion()">
          <ion-icon slot="start" name="settings-outline"></ion-icon>
          <ion-label>Configuraci√≥n</ion-label>
        </ion-item>

        <ion-item button detail="false" (click)="cerrarSesion()">
          <ion-icon slot="start" name="log-out-outline" color="danger"></ion-icon>
          <ion-label color="danger">Cerrar sesi√≥n</ion-label>
        </ion-item>
      </ion-list>
    </ng-template>
  </ion-popover>
</ion-header>


<ion-content class="contentCustom">
  <app-resumen
    *ngIf="false"
    [MostrarIngresos]="false"
    [MostrarInvitados]="false"
    [MostrarAceptados]="false">
  </app-resumen>

  <!-- üî• SOLO PROMOCIONES / PRODUCTOS -->
  <ion-grid class="promos-grid">
    <ion-row>
      <ion-col size="12">
        <div class="promos-header">
          <div>
            <p>
              <small>
                ¬°Mantente al d√≠a con las promociones m√°s recientes!
              </small>
            </p>
          </div>

          <!-- Filtro de categor√≠as -->
          <div class="promo-filters">
            <ion-item lines="none">
              <ion-label position="stacked">Categor√≠as</ion-label>
              <ion-select
                [(ngModel)]="categoriaSeleccionada"
                interface="popover"
                placeholder="Todas">
                <ion-select-option [value]="null">Todas</ion-select-option>
                <ion-select-option
                  *ngFor="let cat of categorias"
                  [value]="cat.id">
                  {{ cat.nombre }}
                </ion-select-option>
              </ion-select>
            </ion-item>
          </div>
        </div>

        <app-loader *ngIf="cargandoPromociones"></app-loader>
      </ion-col>
    </ion-row>

    <!-- vac√≠o -->
    <ion-row *ngIf="!cargandoPromociones && promocionesFiltradas.length === 0">
      <ion-col size="12" class="ion-text-center">
        <small>No hay productos/promociones vigentes para tu Network.</small>
      </ion-col>
    </ion-row>

    <!-- LISTA DE PROMOS -->
    <ion-row *ngIf="!cargandoPromociones && promocionesFiltradas.length > 0">
      <ion-col size="12" *ngFor="let promo of promocionesFiltradas">
        <ion-card class="promo-card" (click)="abrirModalPromocion(promo)">
          <div class="promo-card-content">
            <!-- üëâ Imagen del producto a la izquierda -->
            <div class="producto-img-wrapper" [class.no-image]="!tieneProductoImg(promo)">
              <ng-container *ngIf="tieneProductoImg(promo); else cuadradoGris">
                <img
                  [src]="getProductoImg(promo)"
                  alt="Imagen producto" />
              </ng-container>

              <ng-template #cuadradoGris>
                <div class="producto-placeholder"></div>
              </ng-template>
            </div>

            <!-- üëâ Info + logo empresa arriba a la derecha -->
            <div class="promo-info">
              <div class="promo-header">
                <h3 class="empresa-nombre">
                  {{ getEmpresaNombre(promo) }}
                </h3>

                <div class="empresa-logo-mini">
                  <img
                    [src]="getEmpresaLogo(promo)"
                    alt="Logo empresa" />
                </div>
              </div>

              <h4 class="promo-nombre">
                {{ $any(promo).nombrePromocion || $any(promo).nombre || $any(promo).titulo }}
              </h4>

              <p class="promo-desc">
                {{ $any(promo).descripcion || $any(promo).detalle || 'Se aplican en...' }}
              </p>
            </div>
          </div>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>