<ion-header>
  <ion-toolbar class="headerColor">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Referidos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="contentCustom">
  <ion-content class="contentCustom">
  <app-resumen
  [MostrarIngresos]="false"
  [MostrarInvitados]="true"
  [MostrarAceptados]="true">
</app-resumen>

  <app-loader *ngIf="cargandoReferidos"></app-loader>

  <ion-item *ngIf="!cargandoReferidos">
    <strong>Referencias generadas</strong>
  </ion-item>

  <ion-item *ngIf="!cargandoReferidos && referidos.length == 0" lines="none">
  <div class="empty-msg">
    <ion-icon name="rocket-outline" class="empty-icon"></ion-icon>
    <div>
      <strong>Sin referidos todavía</strong><br />
      <span>Comparte tus productos y convierte a tus contactos en ingresos.  
      ¡Entre más invites, más ganas!</span>
    </div>
  </div>
</ion-item>


  <ng-container *ngFor="let referido of referidos">
    <ion-item (click)="abrirModalVisualizacion(referido)">
      <div class="itemReferencia">
        <ion-grid>
          <ion-row>
            <ion-col size="12">

              <!-- Encabezado: nombre + comisión -->
              <section class="referido-header">
                <div class="referido-nombre">{{ referido.nombreCompleto }}</div>
                <div class="referido-comision">
                  <div class="monto" *ngIf="referido.estatusReferenciaID == 3">{{ referido.comisionTexto }}</div>
                  <div class="monto-pendiente" *ngIf="referido.estatusReferenciaID != 3">{{ referido.comisionTexto }}</div>
                </div>
              </section>

              <!-- Correo
              <div class="referido-contacto">
                <ion-icon name="mail-outline" *ngIf="referido.email"></ion-icon>
                <span *ngIf="referido.email; else sinCorreo" class="email-text">{{ referido.email }}</span>
                <ng-template #sinCorreo><span class="muted">Sin correo</span></ng-template>
              </div> -->

              <!-- Teléfono -->
              <div class="referido-contacto">
                <ion-icon name="logo-whatsapp"></ion-icon>
                <span>
                  {{ referido.celularE164 ? referido.celularView : 'No proporcionado' }}
                </span>
                <ion-badge
                  *ngIf="referido.celularE164 && referido.celularInvalido"
                  color="warning"
                  class="badge-susp">
                  sospechoso
                </ion-badge>
              </div>

              <!-- Fecha registro -->
              <div class="referido-contacto">
                <ion-icon name="calendar-outline"></ion-icon>
                <span>{{ referido.fechaRegistro | date:'shortDate' }}</span>
              </div>

              <!-- Producto / Empresa -->
              <section class="referido-producto">
                <div class="producto-nombre">{{ referido.productoNombre }}</div>
                <div class="empresa-nombre">{{ referido.empresaRazonSocial }}</div>
              </section>

              <!-- Último seguimiento -->
              <section class="referido-ultimo-seg" *ngIf="referido.ultimoSeguimientoTexto; else sinSegPrev">
                <ion-icon name="chatbubble-ellipses-outline" class="seg-icon"></ion-icon>

                <!-- línea = texto clamped + botón fijo -->
                <div class="seg-line">
                  <div class="seg-text line-clamp-2">
                    {{ referido.ultimoSeguimientoTexto }}
                  </div>

                  <span
                    class="seg-plus"
                    (click)="abrirModalVisualizacion(referido); $event.stopPropagation()">+</span>
                </div>

                <div class="seg-meta">
                  <ion-icon name="time-outline"></ion-icon>
                  <span class="seg-date">{{ formatFecha(referido.ultimoSeguimientoFecha) }}</span>
                  <ion-badge color="success" *ngIf="referido._segEsReciente">nuevo</ion-badge>
                </div>
              </section>


              <ng-template #sinSegPrev>
                <section class="referido-ultimo-seg muted">
                  <ion-icon name="chatbubble-ellipses-outline" class="seg-icon"></ion-icon>
                  <div class="seg-preview">
                    <div class="seg-text">Aún no hay seguimientos</div>
                  </div>
                </section>
              </ng-template>

            </ion-col>
          </ion-row>
        </ion-grid>
      </div>
    </ion-item>
  </ng-container>
</ion-content>